{% extends "base.html" %}
{% load wagtailcore_tags static %}
{% block content %}
    <h1 class="text-3xl font-bold mb-4">{{ page.title }}</h1>
    {{ page.intro|richtext }}
    <form method="get" class="my-4 flex flex-wrap gap-4">
        <div>
            <label class="block">Category:</label>
            <select name="category" class="border p-2">
                <option value="">All</option>
                {% for cat in categories %}
                    <option value="{{ cat }}" {% if selected_category == cat %}selected{% endif %}>{{ cat|capfirst }}</option>
                {% endfor %}
            </select>
        </div>
        <div>
            <label class="block">Tag:</label>
            <input name="tag" value="{{ selected_tag }}" class="border p-2">
        </div>
        <div>
            <label class="block">Search:</label>
            <input name="query" value="{{ selected_query }}" class="border p-2">
        </div>
        <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded">Apply Filters</button>
    </form>
    {% if selected_category or selected_tag or selected_query %}
        <p class="mb-4">
            Filters applied:
            {% if selected_category %}Category: {{ selected_category|capfirst }}{% endif %}
            {% if selected_tag %}Tag: {{ selected_tag }}{% endif %}
            {% if selected_query %}Search: {{ selected_query }}{% endif %}
        </p>
    {% endif %}
    <ul class="list-none">
        {% for resource in resources %}
            <li class="border-b py-4">
                <h2 class="text-xl font-semibold">{{ resource.title }}</h2>
                {{ resource.description|richtext }}
                {% if resource.file %}
                    <a href="{{ resource.file.url }}" class="text-blue-500">Download File</a>
                {% endif %}
                <p>Category: {{ resource.category|capfirst }}</p>
                <p>Tags: {% for tag in resource.tags.all %}{{ tag }}{% if not forloop.last %}, {% endif %}{% endfor %}</p>
            </li>
        {% empty %}
            <li>No resources found.</li>
        {% endfor %}
    </ul>
    <div class="mt-4">
        {% if resources.has_previous %}
            <a href="?page={{ resources.previous_page_number }}{% if selected_category %}&category={{ selected_category }}{% endif %}{% if selected_tag %}&tag={{ selected_tag }}{% endif %}{% if selected_query %}&query={{ selected_query }}{% endif %}" class="text-blue-500">Previous</a>
        {% endif %}
        {% if resources.has_next %}
            <a href="?page={{ resources.next_page_number }}{% if selected_category %}&category={{ selected_category }}{% endif %}{% if selected_tag %}&tag={{ selected_tag }}{% endif %}{% if selected_query %}&query={{ selected_query }}{% endif %}" class="text-blue-500">Next</a>
        {% endif %}
    </div>
{% endblock %}